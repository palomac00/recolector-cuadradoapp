name: ğŸ§® Parser JSON 141

on:
  schedule:
    - cron: '*/10 * * * *'  # Cada 10min
  workflow_dispatch:

jobs:
  parse:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: pip install pandas openpyxl pytz

    - name: Fetch JSON real desde Cuadrado  â† â† â† NUEVO PASO AQUÃ
      run: |
        curl -s "https://cuadrado.com.ar/api/get-parada?query=%7B%22id%22%3A%22LP1912%22%2C%22lineas%22%3A%5B%7B%22codigo%22%3A141%2C%22empresa%22%3A%229DJ%22%7D%5D%7D" > input.json
    
    - name: Crear data/
      run: mkdir -p data
    
    - name: Crear JSON de prueba
      run: |
        cat > input.json << 'EOF'
        {
          "arribos": [
            {"tiempo": 5, "bandera": "23_HERNANDEZ", "programado": false},
            {"tiempo": 15, "bandera": "215B_EL PATO", "programado": true},
            {"tiempo": 26, "bandera": "10_OLMOS", "programado": false}
          ]
        }
        EOF

    - name: Parsear JSON
      run: python parse_json.py input.json
    
    - name: Commit results
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ“Š Arribos 141 actualizados - ${{ github.run_number }}"
        file_pattern: 'data/*'
        branch: main
